!function(){var e="http://multimedia.telesurtv.net/api/",a=10,t=["./templates/menuItem.html","./templates/editForm.html","./templates/programaRow.html","./templates/mediaRow.html","./templates/modals.html"],o="noticia",i="Noticias",r="Caracas",n=["tipo_clip","categoria","pais","corresponsal","programa"],s={tipo_clip:{es:[{slug:"videolibro",nombre_plural:"Videolibros",nombre:"Videolibro"}],en:[]}},l={noticia:"notebook",entrevista:"users",programa:"layers",reportaje:"chemistry",documental:"folder","especial-web":"globe",seriado:"doc",infografia:"info","fax-sur":"compass",promocionales:"gost",videolibro:"book-open"},c="es",d={},p=0,u={},m="";$("#menu_tipos").on("click","a",function(e){e.preventDefault(),h("list-view"),o=$(this).attr("data-tipo"),i=$(this).attr("title"),m="",p=0,$("div.modos a:first").trigger("click")}),$("button[data-action=mostrar-mas]").click(function(){$("#cargando").show(),$(this).css({opacity:"0.3"}),p+=a,v(d)}),$("div.modos").on("click","a",function(e){e.preventDefault();var a=$(this),t={},o="",i=a.parents("ul[class='dropdown-menu']");if("dropdown"!=a.attr("data-modo")){switch($(".modos a.selected").removeClass("selected"),$(".modos button.selected").removeClass("selected"),i.prev("button").length>0&&i.prev("button").addClass("selected"),a.addClass("selected").siblings().removeClass("selected"),a.attr("data-modo")){case"publicados":t={publicado:!0},o="Publicados";break;case"despublicados":t={publicado:!1,usuario_creacion:r},o="Descpublicados";break;case"cargados":t={usuario_creacion:r},o="Descpublicados";break;case"seleccion":t={seleccionado:!0},o="Selección del Editor";break;case"secciones":t={categoria:a.attr("data-valor")},o=a.html();break;case"programas":t={programa:a.attr("data-valor")},o=a.html();break;case"corresponsales":t={corresponsal:a.attr("data-valor")},o="Corresponsales";break;case"cronologia":t={tiempo:a.attr("data-valor")},o=a.html();break;case"populares":t={orden:"popularidad"},o="Populares"}$("ul.media-list").empty(),$("[data-action=mostrar-mas]").css({opacity:0}),m=" &raquo; "+o,v({params:t})}}),$("#modallinkembed").on("show.bs.modal",function(e){var a=$(e.relatedTarget).parents(".media-row").data("clip");$(this).find(".modal-body").mustache("modal-linksembed",{clip:a})}),$("#list-view").on("click","a.autothumbnail",function(e){e.preventDefault();{var a=$(this).parents(".media-row");a.data("clip")}}),$("#list-view").on("click","a.eliminar",function(e){e.preventDefault();var a=$(this).parents(".media-row"),t=a.data("clip");a.css("background","#e3e3e3"),bootbox.confirm("Confirme que desea eliminar permanentemente este clip",function(e){e&&$.ajax({url:"http://captura-telesur.openmultimedia.biz/XXeliminar/",dataType:"json",type:"POST",data:{slug:t.slug,id:t.id}}).done(function(){a.slideUp()}).fail(function(){bootbox.alert("Error eliminando clip, verifique que aún tiene conexión a Internet e intente de nuevo.")}),a.css("background","")})}),$("#list-view").on("click","a.despublicar",function(e){e.preventDefault();var a=$(this).parents(".media-row"),t=a.data("clip");a.css("background","#e3e3e3"),bootbox.confirm("Confirme que desea despublicar este clip",function(e){e&&$.ajax({url:"http://captura-telesur.openmultimedia.biz/XXdespublicar/",dataType:"json",type:"POST",data:{slug:t.slug,id:t.id}}).done(function(){a.slideUp()}).fail(function(){bootbox.alert("Error despublicando clip, verifique que aún tiene conexión a Internet e intente de nuevo.")}),a.css("background","")})}),$("#list-view").on("click","a.publicar",function(e){e.preventDefault();var a=$(this).parents(".media-row"),t=a.data("clip");a.css("background","#e3e3e3"),bootbox.confirm("Confirme que desea publicar este clip",function(e){e&&$.ajax({url:"http://captura-telesur.openmultimedia.biz/XXpublicar/",dataType:"json",type:"POST",data:{slug:t.slug,id:t.id}}).done(function(){a.slideUp()}).fail(function(){bootbox.alert("Error publicando clip, verifique que aún tiene conexión a Internet e intente de nuevo.")}),a.css("background","")})}),$("#list-view").on("click","a.edit",function(e){e.preventDefault();var a=$(this).parents(".media-row").data("clip");h("edit-view",{clip:a})}),$("#menu_nuevo").on("click","a.clip",function(e){e.preventDefault(),h("edit-view",{clip:null})}),$("#form-search").on("submit",function(e){e.preventDefault();var a=$("#input-search").val();$("ul.media-list").empty(),m=" Búsqueda: "+a,v({params:{texto:a}}),$("#input-search").val("")}),$("#menu_settings").on("click","a.programas",function(){$.each(u.programa,function(e,a){$('<tr draggable="true" />').mustache("programa-row",{programa:a}).appendTo($("#programas_list tbody.mismo-alto"))}),h("programas-view")}),$("#edit-view").on("click","button.cancel",function(){h("list-view")}),$("#edit-view").on("click","button.save",function(){var e=$(this);e.attr("disabled","disabled");var a=e.parents("section").data("params").clip;$.ajax({url:"http://captura-telesur.openmultimedia.biz/editar/",dataType:"json",type:"POST",data:{slug:a.slug,id:a.id,titulo:$("#titulo").val().trim(),programa:$("#programa").val(),categoria:$("#categoria").val(),tipo:$("#tipo").val(),descripcion:$("#descripcion").val().trim(),hashtags:$("#hashtags").val().trim(),corresponsal:$("#corresponsal").val(),seleccionado:$("#seleccionado").is(":checked")?$("#seleccionado").val():"",idioma:c}}).done(function(){h("list-view")}).fail(function(){alert("Error guardando la información. Verifique que aún tenga conexión a Internet e intente de nuevo"),e.removeAttr("disabled")})});var h=function(e,a){if($("section.view").hide(),$("section#"+e).data("params",a).show(),window.scrollTo(0,0),a)switch(e){case"edit-view":if($(".editar-label").html(a.clip?"EDITAR CLIP":"NUEVO CLIP"),$("#edit-form").empty().mustache("clip-edit-form",{clip:a.clip,resources_data:u}),a.clip)a.clip.tipo&&$("#tipo").val(a.clip.tipo.slug),a.clip.categoria&&$("#categoria").val(a.clip.categoria.slug),a.clip.programa&&$("#programa").val(a.clip.programa.slug),a.clip.corresponsal&&$("#corresponsal").val(a.clip.corresponsal.slug);else{OMUpload.setup({element:document.getElementById("uploader"),autoUpload:!0,multiple:!1,text:{uploadButton:_("Elegir archivo...")},callbacks:{onUpload:function(){$(".editar_form button.guardar").attr("disabled","disabled"),$(".qq-upload-button").empty(),$(".editar_form .archivo_status").empty().removeClass("success").removeClass("error")},onComplete:function(e,a,t){t.error&&($(".qq-upload-button").show(),alert(t.error),$(".nuevo_form .archivo_status").html("<h5>ERROR: "+t.error).addClass("error").removeClass("success"),$(".qq-upload-fail").empty()),self&&t.id&&(self.archivo_img_id=t.id,$(".editar_form .archivo_status").html(_("Archivo subido correctamente")).addClass("success").removeClass("error"),$(".editar_form button.guardar").removeAttr("disabled"),$("#uploader_img").hide())}}})}}},v=function(t){$("#cargando").show(),$("div.content-heading h2").html('<span style="top:25px;left:20px;" class="whirl line"></span>'),$("ul.media-list").css("min-height","0px"),d=$.extend({tipo:o,primero:p+1,ultimo:p+a,detalle:"completo",publicado:!0,autenticado:"admin2.0"},t.params),$.ajax({url:e+"clip/?callback=?&nc="+Math.random(),cache:!1,data:d,dataType:"jsonp"}).done(function(e){$("#cargando").hide(),e.length>0?($("div.content-heading h2").html(i+m),e.length==a&&$("[data-action=mostrar-mas]").css({opacity:1}),$.each(e,function(e,a){f(a)})):($("ul.media-list").css("min-height","300px"),$("div.content-heading h2").html(i),$("ul.media-list").html("<h3>Sin contenido</h3>"))})},f=function(e){var a=$("ul.media-list");e.fecha_texto=getFechaTexto(e.fecha,!0,!0),$('<li class="media-row" />').mustache("media-row",{clip:e}).data("clip",e).appendTo(a)},b=function(a){var o=[];$.each(n,function(a,t){o.push($.ajax({url:e+t+"/?callback=?",data:{ultimo:300,idioma:c,activo:!0},dataType:"jsonp"}).done(function(e){t in s&&(e=e.concat(s[t][c])),u[t]=e}))}),$.each(t,function(e,a){o.push($.Mustache.load(a))}),$.when.apply($,o).then(function(){a()})},g=function(){$("ul#menu_tipos").mustache("menu-tipos-item",{tipos:u.tipo_clip}),$("ul#menu_tipos li a").each(function(){var e=$(this).attr("data-tipo");$(this).find("em").addClass(e in l?"icon-"+l[e]:"icon-doc")})},w=function(){$("ul#menu_secciones").mustache("menu-secciones-item",{categorias:u.categoria}).appendTo($("#menu_secciones")),$("ul#menu_programas").mustache("menu-programas-item",{programas:u.programa}).appendTo($("#menu_programas")),$("ul#menu_corresponsales").mustache("menu-corresponsales-item",{corresponsales:u.corresponsal}).appendTo($("#menu_corresponsales"))};$(document).ready(function(){b(function(){g(),w(),$("#list-view").show(),$("#menu_tipos a[data-tipo="+o+"]").trigger("click")})})}();
