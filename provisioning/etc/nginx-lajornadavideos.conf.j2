upstream lajornadavideos {
    server unix:///run/uwsgi/app/lajornadavideos/socket;
}

server {
    listen  80;
    server_name .videos.jornada.com.mx;
    server_name .videos-stg.jornada.com.mx;
    server_name .videos-dev.jornada.com.mx;
    server_name .videos-dev-lajornada.openmultimedia.biz;
    charset     utf-8;

    add_header Vary Accept-Encoding;

    # max upload size
    client_max_body_size 75M;

    location /media  {
        alias /mnt/lajornadavideos_storage/media;


        location ~* \.mp4$ {
            mp4;
            gzip off;
            mp4_buffer_size     2m;
            mp4_max_buffer_size 10m;
            if ($args ~ download) {
                add_header Content-Type "application/octet-stream";
                add_header Content-Disposition "attachment; filename=$1";
            }
        }

        location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
            expires 1w;
            log_not_found off;
        }
    }

    location /static {
        alias /mnt/lajornadavideos_storage/frontend_static;

        location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
            expires 1y;
            log_not_found off;
        }

        location ~* \.(eot|vtt|mp4|m3u8|ttf|woff|woff2)$ {
            add_header Access-Control-Allow-Origin *;
        }
    }

    
    # Finally, send all non-media requests to the Django server.
    location / {
        uwsgi_pass  lajornadavideos;
        include     /vagrant/provisioning/etc/uwsgi_params;
    }
}